import{d as J,N as A,r as g,a2 as K,o as i,c as m,f as s,w as a,g as n,$ as y,ac as _,m as c,e as w,i as b,aa as x,C as E,j as N,k as P,E as Q}from"./index-0207282d.js";import{E as W,a as X}from"./el-form-item-cffcfafd.js";import{E as Y,a as Z}from"./el-table-column-def74e1d.js";import"./el-checkbox-816fe3b3.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-90f9afbe.js";import{_ as ee}from"./InputDecimal.vue_vue_type_style_index_0_lang-5ed575e3.js";/* empty css                 */import"./el-tag-0efdc75d.js";/* empty css                  */import{E as le,a as te}from"./el-select-69ed96fa.js";import{u as ae}from"./enum-569bea9e.js";import{u as L}from"./useRule-31f8c705.js";const oe={class:"flex-center-x py-2 w-full"},ne=w("div",{class:"flex-1"},"收费数量",-1),se={class:"flex-1"},ue={class:"text-xs text-gray-400"},de={class:"flex-center mt-6"},he=J({__name:"AddEditModel",props:{row:{type:Object,default:()=>({})},modules:{type:Object,default:()=>({})},payTypes:{type:Object,default:()=>({})},feeType:{type:Object,default:()=>({})},feeList:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1}},emits:["close"],setup(p,{emit:U}){const k=p,$=ae(),B=()=>{t.value.tradeType=""},F=A(()=>k.feeList.find(u=>u.module===t.value.module)??{}),T={empty:L.empty(),gteint:[L.empty(),L.gteint()]},j=g(),t=g({module:1,coinList:[]}),v=A(()=>{var u;return!!((u=k.row)!=null&&u.tradeType)});K(async()=>{var u;if(v.value){const o=await N.post("/fee/info",{tradeType:(u=k.row)==null?void 0:u.tradeType});t.value={...o,coinList:o.coinList.map(d=>({...d,key:[d.coinCode,d.chainType].join(",")}))}}});const O=()=>{t.value.coinList.push({id:"",key:"",chainType:"",coinCode:"",feeAmount:""})},S=u=>{t.value.coinList.splice(u,1)},I=u=>{const[o,d]=u.key.split(",");u.coinCode=o,u.chainType=d},V=g(!1),R=u=>{const o=t.value.coinList.filter((d,r)=>r!==u)||[];return $.coinList.filter(d=>!o.some(r=>r.coinCode===d.coinCode&&d.chainType===r.chainType))},z=()=>{j.value.validate(async u=>{if(u)try{V.value=!0,await N.post("/fee/save",{...t.value,coinList:t.value.coinList.filter(o=>o.coinCode&&o.feeAmount!==""&&+o.feeAmount>=0)}),U("close",!0)}finally{V.value=!1}})};return(u,o)=>{const d=le,r=te,f=W,h=P,C=Y,D=Q,H=ee,M=Z,q=X;return i(),m("div",null,[s(q,{ref_key:"formRef",ref:j,model:n(t),"label-width":"140px","label-position":"left",inert:p.readonly},{default:a(()=>[s(f,{label:"模块",rules:T.empty,prop:"module"},{default:a(()=>[s(r,{modelValue:n(t).module,"onUpdate:modelValue":o[0]||(o[0]=e=>n(t).module=e),class:"w-full",disabled:n(v),onChange:B},{default:a(()=>[(i(!0),m(y,null,_(p.modules,(e,l)=>(i(),c(d,{key:l,label:e,value:+l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["rules"]),s(f,{label:"交易名称",rules:T.empty,prop:"tradeType"},{default:a(()=>[s(r,{modelValue:n(t).tradeType,"onUpdate:modelValue":o[1]||(o[1]=e=>n(t).tradeType=e),class:"w-full",disabled:n(v)},{default:a(()=>[(i(!0),m(y,null,_(n(F).tradeList.filter(e=>n(v)?!0:e.available),(e,l)=>(i(),c(d,{key:l,label:e.desc,value:+e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["rules"]),s(f,{label:"支付方式",rules:T.empty,prop:"payType"},{default:a(()=>[s(r,{modelValue:n(t).payType,"onUpdate:modelValue":o[2]||(o[2]=e=>n(t).payType=e),class:"w-full"},{default:a(()=>[(i(!0),m(y,null,_(p.payTypes,(e,l)=>(i(),c(d,{key:l,label:e,value:+l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(f,{label:"收费方式",rules:T.empty,prop:"feeType"},{default:a(()=>[s(r,{modelValue:n(t).feeType,"onUpdate:modelValue":o[3]||(o[3]=e=>n(t).feeType=e),class:"w-full"},{default:a(()=>[(i(!0),m(y,null,_(p.feeType,(e,l)=>(i(),c(d,{key:l,label:e,value:+l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(f,{"label-width":"0"},{default:a(()=>[w("div",oe,[ne,p.readonly?x("",!0):(i(),c(h,{key:0,type:"primary",onClick:O},{default:a(()=>[b("添加")]),_:1}))]),s(M,{data:n(t).coinList,class:"w-full",stripe:""},{default:a(()=>[s(C,{label:"币种名称","min-width":"100",align:"center","show-overflow-tooltip":""},{default:a(e=>[s(r,{modelValue:e.row.key,"onUpdate:modelValue":l=>e.row.key=l,placeholder:"Select",class:"w-full",onChange:l=>I(e.row)},{default:a(()=>[(i(!0),m(y,null,_(R(e.$index),(l,G)=>(i(),c(d,{key:G,label:l.coinName,value:[l.coinCode,l.chainType].join(","),class:"!px-2 flex-center-x gap-2"},{default:a(()=>[w("span",se,E(l.coinName),1),w("span",ue,E(l.chainType),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(C,{label:"所属链","min-width":"100",align:"center","show-overflow-tooltip":""},{default:a(e=>[s(D,{modelValue:e.row.chainType,"onUpdate:modelValue":l=>e.row.chainType=l,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(C,{label:n(t).feeType===1?"收费数量":"收费比率","min-width":"100",align:"center","show-overflow-tooltip":""},{default:a(e=>[s(H,{modelValue:e.row.feeAmount,"onUpdate:modelValue":l=>e.row.feeAmount=l,min:0,max:n(t).feeType===1?1/0:100,precision:n(t).feeType===1?6:2},{suffix:a(()=>[b(E(n(t).feeType===1?"":"%"),1)]),_:2},1032,["modelValue","onUpdate:modelValue","max","precision"])]),_:1},8,["label"]),p.readonly?x("",!0):(i(),c(C,{key:0,label:"操作","min-width":"100",align:"center","show-overflow-tooltip":""},{default:a(e=>[s(h,{type:"danger",size:"small",plain:"",onClick:l=>S(e.$index)},{default:a(()=>[b("删除")]),_:2},1032,["onClick"])]),_:1}))]),_:1},8,["data"])]),_:1})]),_:1},8,["model","inert"]),w("div",de,[s(h,{type:"info",disabled:n(V),onClick:o[4]||(o[4]=e=>U("close"))},{default:a(()=>[b("关闭")]),_:1},8,["disabled"]),p.readonly?x("",!0):(i(),c(h,{key:0,type:"primary",loading:n(V),onClick:z},{default:a(()=>[b("保存")]),_:1},8,["loading"]))])])}}});export{he as _};
