import{_ as R}from"./Lottie.vue.zqhCm3QD.js";import{cG as V,bF as j,bG as H,n as z,cH as L,u as x,b as q,i as K,a as X,cI as D,cu as Y,H as Z}from"./entry.iYjkhHK1.js";import{s as J,E as P,d as Q,a as $,w as F,ao as U,an as tt,F as m,G as g,u as y,H as a,a2 as p,T as et,al as nt,R as st,X as ot,Y as A,a4 as M,Z as ct,W as at}from"./swiper-vue.o0IHd9hR.js";import{u as it}from"./useMutation.MFSmmj-f.js";import{u as rt}from"./useDisconnect.v5nVKwd6.js";import{u as lt}from"./useSwitchChain.oHENUefy.js";import{u as ut}from"./useSignMessage.CDg4ZBtt.js";import"./getConnectorClient.pAPlZtnz.js";async function dt(t,n){var i;let e;if(typeof n.connector=="function"?e=t._internal.connectors.setup(n.connector):e=n.connector,e.uid===t.state.current)throw new V;try{t.setState(u=>({...u,status:"connecting"})),e.emitter.emit("message",{type:"connecting"});const c=await e.connect({chainId:n.chainId}),r=c.accounts;return e.emitter.off("connect",t._internal.events.connect),e.emitter.on("change",t._internal.events.change),e.emitter.on("disconnect",t._internal.events.disconnect),await((i=t.storage)==null?void 0:i.setItem("recentConnectorId",e.id)),t.setState(u=>({...u,connections:new Map(u.connections).set(e.uid,{accounts:r,chainId:c.chainId,connector:e}),current:e.uid,status:"connected"})),{accounts:r,chainId:c.chainId}}catch(c){throw t.setState(r=>({...r,status:r.current?"connected":"disconnected"})),c}}let k=[];function B(t){const n=t.connectors;return j(k,n)?k:(k=n,n)}function pt(t,n){const{onChange:e}=n;return t._internal.connectors.subscribe((i,c)=>{e(Object.values(i),c)})}function mt(t){return{mutationFn(n){return dt(t,n)},mutationKey:["connect"]}}function gt(t={}){const n=H(t),e=J(B(n));return pt(n,{onChange(){e.value=B(n)}}),e}function ht(t={}){const{mutation:n}=t,e=H(t),i=gt({config:e}),c=mt(e),{mutate:r,mutateAsync:u,...h}=it({...n,...c});return P(f=>{const v=e.subscribe(({status:d})=>d,(d,w)=>{w==="connected"&&d==="disconnected"&&h.reset()});f(v)}),{...h,connect:r,connectAsync:u,connectors:i}}const ft={class:"p-[30px] text-main2"},_t={key:0},yt={class:"text-base md:text-xl font-semibold mb-2"},vt={class:"text-sm text-gray2"},wt={class:"my-5 rounded-2xl bg-[#F2F8FF] p-5 flex flex-wrap gap-[10px]"},Ct=["onClick"],bt={class:"w-6",alt:""},xt={key:1},Ft={class:"text-base md:text-xl font-semibold mb-2"},kt={class:"text-sm text-gray2"},St={class:"h-[300px]"},Tt=Q({__name:"WalletDialog",props:{needSign:{type:Boolean,default:!0},chainType:{type:String,default:""}},emits:["close"],setup(t,{emit:n}){const e=n,i=t,{error:c,connect:r}=ht(),{disconnect:u}=rt(),{switchChainAsync:h}=lt(),{address:f,isConnected:v,chain:d}=z(),w=L(),S=x().app,I=S.chainId(i.chainType)||S.chains[0].chainId,{data:N,error:T,signMessage:W}=ut(),C=$(1),G=async o=>{C.value=2,u(),await Y(500);try{const s=Z().$getConnectors(o);r({connector:s}),x().web3.setWalletType(o,s)}catch(s){console.log("connect-error",s)}};F([c,T],([o,s])=>{const l=o||s;l&&(C.value=1,q.error((l==null?void 0:l.message)??l))});const E=$("");return F(v,async o=>{var s;if(o)try{I!==((s=d==null?void 0:d.value)==null?void 0:s.id)&&await h({chainId:I})}finally{i.needSign?W({message:E.value=new Date().toString()}):e("close",f.value)}}),F(N,async o=>{var s;if(o){const l=((s=K().params.code)==null?void 0:s[0])??"",{data:b}=await X.postForm("/address-login",{address:f.value,sign:o,random:E.value,refCode:l});x().app.login(b.value.data)}}),(o,s)=>{const l=U("i18n-t"),b=R,O=tt("lazy");return m(),g("div",ft,[y(C)===1?(m(),g("div",_t,[a("div",yt,p(o.$t("login.t52")),1),a("div",vt,p(o.$t("login.t53")),1),a("div",wt,[(m(!0),g(et,null,nt(y(w),_=>(m(),g("button",{key:_,type:"button",class:"flex-center rounded-lg gap-[10px] text-base px-4 py-3 bg-[linear-gradient(90deg,#F0EAF0_0%,#E4EFF4_100%)] hover:bg-[linear-gradient(90deg,#F6D5F6_0%,#BDE6F8_100%)]",onClick:It=>G(_)},[st(a("img",bt,null,512),[[O,"/static/img/wallets/"+y(D)[_].icon]]),a("span",null,p(y(D)[_].name),1)],8,Ct))),128))]),t.needSign?(m(),ot(l,{key:0,keypath:"login.t54",class:"text-sm text-gray2",tag:"div"},{terms:A(()=>[a("span",{class:"link-a",onClick:s[0]||(s[0]=M(()=>{},["stop","prevent"]))},p(o.$t("login.t08")),1)]),privacy:A(()=>[a("span",{class:"link-a",onClick:s[1]||(s[1]=M(()=>{},["stop","prevent"]))},p(o.$t("login.t09")),1)]),_:1})):ct("",!0)])):(m(),g("div",xt,[a("div",Ft,p(o.$t("login.t55")),1),a("div",kt,p(o.$t("login.t56")),1),a("div",St,[at(b,{src:"/lottie/connecting.json",class:"w-full h-full"})])]))])}}});export{Tt as default};
