import{d as $,r as n,a as z,t as G,o as L,m as P,w as u,f as a,g as l,e as p,ao as g,i as T,j as _,a8 as S,E as q,k as D}from"./index-0207282d.js";import{E as J,a as Q}from"./el-form-item-cffcfafd.js";/* empty css                  */import{E as W}from"./el-tree-ff8d1f17.js";import{E as X}from"./el-checkbox-816fe3b3.js";import{E as Y}from"./el-switch-fc971dae.js";/* empty css                 */import{u as h}from"./useRule-31f8c705.js";const Z={class:"flex"},ee=p("div",{class:"w-24 leading-10"},"菜单权限",-1),le={class:"flex-1"},te={class:"flex justify-center mt-6"},ie=$({__name:"AddEditModal",props:{row:{type:Object,default:()=>{}}},emits:["close"],setup(K,{emit:w}){const f=K,x=n(),t=n({}),k=h.empty(),M=[h.empty(),h.gtint()],d=n(),R=z({children:"children",label:"name"}),m=n([]),i=n(!1),v=n(!1),r=n(!0),C=()=>{let s=m.value;for(let e=0;e<s.length;e++)d.value.store.nodesMap[s[e].id].expanded=i.value},U=()=>{d.value.setCheckedNodes(v.value?m.value:[])},F=()=>{},N=()=>{let s=d.value.getCheckedKeys(),e=d.value.getHalfCheckedKeys();return s.unshift.apply(s,e),s},A=async()=>{const s=await _.get("/sys/menu/treeselect");m.value=s},B=async()=>{const{menus:s,checkedKeys:e}=await _.get("/sys/menu/roleMenuTreeselect/"+f.row.id);m.value=s,r.value=!1,S(()=>{i.value=!0,C(),d.value.setCheckedKeys(e),r.value=!0})};G(()=>{f.row.id?B():A(),f.row.id&&(t.value={...f.row})});const c=n(!1),j=()=>{x.value.validate(async s=>{if(s){c.value=!0,t.value.menuIds=N();try{t.value.id?await _.put(`/sys/role/${t.value.id}`,t.value):await _.post("/sys/role",t.value),c.value=!1,w("close",!0)}catch{c.value=!1}}})};return(s,e)=>{const V=q,y=J,I=Y,b=X,H=W,E=D,O=Q;return L(),P(O,{ref_key:"formRef",ref:x,model:l(t),"label-width":"96px",size:"large","label-position":"left"},{default:u(()=>[a(y,{label:"角色名称",prop:"name",rules:l(k)},{default:u(()=>[a(V,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).name=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(y,{label:"权限字符",prop:"key",rules:l(k)},{default:u(()=>[a(V,{modelValue:l(t).key,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).key=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(y,{label:"展示顺序",prop:"sort",rules:M},{default:u(()=>[a(V,{modelValue:l(t).sort,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).sort=o)},null,8,["modelValue"])]),_:1}),a(y,{label:"状态",prop:"status",rules:l(k)},{default:u(()=>[a(I,{modelValue:l(t).status,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).status=o),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["rules"]),p("div",Z,[ee,p("div",le,[p("div",null,[a(b,{modelValue:l(i),"onUpdate:modelValue":e[4]||(e[4]=o=>g(i)?i.value=o:null),label:"展开/折叠",onChange:C},null,8,["modelValue"]),a(b,{modelValue:l(v),"onUpdate:modelValue":e[5]||(e[5]=o=>g(v)?v.value=o:null),label:"全选/全不选",onChange:U},null,8,["modelValue"]),a(b,{modelValue:l(r),"onUpdate:modelValue":e[6]||(e[6]=o=>g(r)?r.value=o:null),label:"父子关联",onChange:F},null,8,["modelValue"])]),a(H,{ref_key:"menu",ref:d,class:"border rounded",data:l(m),"show-checkbox":"","node-key":"id","check-strictly":!l(r),"empty-text":"加载中",props:l(R)},null,8,["data","check-strictly","props"])])]),p("div",te,[a(E,{type:"info",disabled:l(c),onClick:e[7]||(e[7]=o=>w("close"))},{default:u(()=>[T("关闭")]),_:1},8,["disabled"]),a(E,{type:"primary",loading:l(c),onClick:j},{default:u(()=>[T("保存")]),_:1},8,["loading"])])]),_:1},8,["model"])}}});export{ie as _};
