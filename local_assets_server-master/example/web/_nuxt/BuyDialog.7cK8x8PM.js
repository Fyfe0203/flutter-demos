import E from"./Item.6KbkTIyk.js";import{_ as M}from"./Balance.vue.nGELT4DT.js";import L from"./Button.bEOq16Ty.js";import{n as R,a as p,t as C,s as U,j as G,u as O,b as Q}from"./entry.nbMAVAIE.js";import{v as Y}from"./el-loading.D22Kx2rY.js";import{u as q}from"./useDialogDemo.rVmU9QRz.js";import{g as J}from"./ether.STda0jBd.js";import{u as K}from"./useFormat.c8XsG793.js";import{r as P}from"./useLoopQuery.o-PQc6Nl.js";import{u as X}from"./useSignMessage.sgOAricP.js";import{d as k,a as v,ad as Z,c as N,j as tt,R as et,u as e,F as ot,G as st,H as o,a2 as l,W as i,Y as T,k as at,a6 as B}from"./swiper-vue.o0IHd9hR.js";import"./Gift.vue.70WnRpdB.js";import"./Type.vue.QPgrbSYI.js";import"./Address.vue.ct6co7hL.js";import"./Num.vue.DVqKCmb3.js";import"./SmallLine.vue.xN8jUQx3.js";import"./index.esm.min.PL--WKLo.js";import"./Timekeeping.vue.YtFmEfTE.js";import"./Coins.vue.qompJPAd.js";import"./OpenSea.vue.nTQIeBsH.js";import"./Item.vue.Lm_0ppoA.js";import"./el-button.fhXFyBz0.js";import"./el-input.LbCLpOjr.js";import"./typescript.WBLZcIum.js";import"./validator.82JMvZTK.js";import"./useMutation.aoGi9GE9.js";import"./getConnectorClient.p5LqdYNQ.js";const nt={class:"p-5 md:p-[30px] grid md:grid-cols-2 gap-5 md:gap-[30px] text-main2 min-h-[400px]"},it={class:"text-lg font-semibold pb-5 hidden md:block"},lt={class:"text-base md:text-lg font-semibold pb-5"},mt={class:"bg-[#F5F7FC] rounded-[10px] text-gray2 px-3 md:px-5 py-2"},ct={class:"flex-center-x gap-5 py-2 md:py-4"},rt={class:"flex-1 text-xs md:text-lg"},dt={class:"flex-center-x gap-5 py-2 md:py-4"},ut={class:"flex-1 text-xs md:text-lg"},pt={class:"flex-center-x gap-5 py-2 md:py-4"},ft={class:"flex-1 text-xs md:text-lg"},bt={class:"pt-3 pb-10 md:py-8 text-gray2 flex-center gap-2"},xt={class:"flex-1 md:flex-none text-xs md:text-base font-normal"},gt=o("div",{class:"h-20 md:h-0"},null,-1),_t={class:"absolute md:static bottom-0 left-0 w-full p-5 md:p-0 bg-white border-t md:border-0 border-[#D9ECFF]"},Qt=k({__name:"BuyDialog",props:{botNo:{},botType:{}},async setup(D){let m,y;const f=v(),c=D,b=k(t=>()=>i("div",{class:"flex-center-x gap-2"},[i("div",{class:t.free?"text-gray2":""},[t.num,B(" "),t.unit]),t.free&&i("div",{class:"bg-[#FF9A3C] rounded-tl-lg rounded-br-lg text-base h-6 px-2 text-white flex-center"},[C("bot.t34")])]),{props:{num:{type:[Number,String],default:""},unit:{type:String,default:""},free:{type:Boolean,default:!1}}}),{isConnected:I}=R(),{signMessageAsync:z}=X(),{data:A,pending:S}=([m,y]=Z(()=>p.get("/bot/exec/buy/info",c,{lazy:!0})),m=await m,y(),m),a=N(()=>{var t;return((t=A.value)==null?void 0:t.data)||{}}),r=v(!1),x=v(""),V=async()=>{var t;try{r.value=!0;const{data:n}=await p.post("/bot/exec/buy",c),s=(t=n.value)==null?void 0:t.data;if(!(s!=null&&s.bizId))throw new Error("No bizId");if(x.value=s.bizId,s!=null&&s.signFlag){I.value||await q.loginWithoutSign();const g=await z({message:{raw:J(s.userOpHash)}}),{data:_}=await p.post("/bot/exec/buy/sign",{botNo:c.botNo,bizId:x.value,signature:g});u(_.value.data)}else u(s)}catch{r.value=!1,P(x.value)}},W=()=>{var s;const{botNo:t,botType:n}=c;r.value=!1,U("/create/"+((s=G(O().enum.botsList,+n))==null?void 0:s.key)+"/"+t),Q.success(C("bot.t69"))};let d;const u=({orderNo:t})=>{p.get("/bot/exec/buy/status",{orderNo:t}).then(({data:n})=>{n.value.data?W():d=setTimeout(u,1e3,{orderNo:t})}).catch(()=>{d=setTimeout(u,1e3,{orderNo:t})})},h=N(()=>K.plus(a.value.price??0,(a.value.free?0:a.value.netWorkFee)??0).toNumber());return tt(()=>{d&&clearTimeout(d)}),(t,n)=>{var w,F,$;const s=E,g=M,_=L,H=Y;return et((ot(),st("div",nt,[o("div",null,[o("div",it,l(t.$t("bot.t65")),1),i(s,{hover:!1,"buy-btn":!1,info:(w=e(a))==null?void 0:w.market},null,8,["info"])]),o("div",null,[o("div",lt,l(t.$t("bot.t66")),1),o("div",mt,[o("div",ct,[o("div",rt,l(t.$t("bot.t67")),1),i(e(b),{class:"text-main2 font-semibold text-sm md:text-lg",num:e(a).price,free:!+e(a).price,unit:` ${t.$stableCoin}`},null,8,["num","free","unit"])]),o("div",dt,[o("div",ut,l(t.$t("account.t12")),1),i(e(b),{class:"text-main2 font-semibold text-sm md:text-lg",num:e(a).netWorkFee,free:e(a).free||!+e(a).netWorkFee,unit:` ${t.$stableCoin}`},null,8,["num","free","unit"])]),o("div",pt,[o("div",ft,l(t.$t("account.t46")),1),i(e(b),{class:"text-main2 font-semibold text-sm md:text-lg",num:e(h),free:!+e(h),unit:` ${t.$stableCoin}`},null,8,["num","free","unit"])])]),o("div",bt,[i(g,{modelValue:e(f),"onUpdate:modelValue":n[0]||(n[0]=j=>at(f)?f.value=j:null),"chain-type":($=(F=e(a))==null?void 0:F.market)==null?void 0:$.chainType,class:"font-semibold text-sm md:text-base w-full md:w-auto"},{default:T(()=>[o("div",xt,l(t.$t("bot.t56"))+"ï¼š",1)]),_:1},8,["modelValue","chain-type"])]),gt,o("div",_t,[i(_,{class:"!h-[46px]",loading:e(r),onClick:V},{default:T(()=>[B(l(t.$t("bot.t68")),1)]),_:1},8,["loading"])])])])),[[H,e(S)]])}}});export{Qt as default};
