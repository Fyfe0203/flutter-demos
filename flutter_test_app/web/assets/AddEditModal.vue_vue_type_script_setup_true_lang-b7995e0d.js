import{d as q,r as E,a2 as G,N as F,o as m,c as C,f as a,w as l,g as i,e as c,$ as N,ac as S,m as T,i as s,aa as J,C as V,j as K,E as Q,k as W}from"./index-0207282d.js";import{E as X,a as Y}from"./el-form-item-cffcfafd.js";import{_ as Z}from"./InputDecimal.vue_vue_type_style_index_0_lang-5ed575e3.js";import{E as ee,a as te}from"./el-table-column-def74e1d.js";import"./el-checkbox-816fe3b3.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-90f9afbe.js";import"./el-tag-0efdc75d.js";/* empty css                  *//* empty css                 */import{E as le,a as oe}from"./el-select-69ed96fa.js";import{E as ae}from"./el-date-picker-792cf559.js";import{u as ie}from"./enum-569bea9e.js";import{u as v}from"./useRule-31f8c705.js";const ne=c("div",{class:"text-lg mb-2"},"1. 基础配置",-1),se={class:"grid grid-cols-2 gap-5"},re=c("div",{class:"text-lg mb-2"},"2. 标的配置",-1),ce={class:"flex-center-x pb-2 w-full"},de=c("div",{class:"flex-1"},"选择标的",-1),pe={class:"flex-1"},ue={class:"text-xs text-gray-400"},me=c("div",{class:"text-lg mb-2"},"3. 其它配置",-1),fe={class:"flex-1"},_e={class:"text-xs text-gray-400"},ve={class:"flex-center-x flex-wrap gap-2 mb-2 text-xs"},ye={class:"flex-center-x flex-wrap gap-2 text-xs"},xe={class:"flex-center mt-6"},Fe=q({__name:"AddEditModal",props:{row:{type:Object,default:()=>({})}},emits:["close"],setup(P,{emit:k}){const U=P,L=ie(),p={empty:v.empty(),gteint:[v.empty(),v.gteint()],gte:[v.empty(),v.gte()],activityEndTime:[{validator(r,o,d){!o||o&&t.value.activityStartTime&&+new Date(o)>=+new Date(t.value.activityStartTime)?d():d(new Error("请输入正确的结束时间"))},trigger:"change"}]},D=E(),t=E({chainType:"",activityStartTime:void 0,activityEndTime:void 0,closeConfig:{principal:void 0,lossRatio:void 0,lossNumber:void 0},coinParamList:[]});G(()=>{const{coinVoList:r,taskVoList:o,createTimeTemp:d,modifyTimeTemp:n,id:h,status:x,closeConfig:_,...f}=U.row;t.value={...f,coinParamList:[...r||[]],closeConfig:{..._||{}}}});const R=()=>{t.value.coinParamList=[]},$=()=>{t.value.coinParamList.push({coinCode:"",chainType:""})},B=r=>{t.value.coinParamList.splice(r,1)},b=F(()=>L.coinList.filter(r=>r.chainType===t.value.chainType)),j=F(()=>b.value.filter(r=>r.experFlag===1)),I=r=>{const{coinCode:o,chainType:d}=b.value.find(n=>n.coinCode===r.coinCode)||{};r.coinCode=o,r.chainType=d},O=r=>{const o=t.value.coinParamList.filter((d,n)=>n!==r)||[];return b.value.filter(d=>!o.some(n=>n.coinCode===d.coinCode)&&!d.experFlag)},y=E(!1),z=async()=>{D.value.validate(async r=>{if(r)try{y.value=!0,await K.post("/activity/"+(U.row.activityNo?"edit":"save"),{...t.value,activityStartTime:+new Date(t.value.activityStartTime),activityEndTime:t.value.activityEndTime?+new Date(t.value.activityEndTime):""}),k("close",!0)}finally{y.value=!1}})};return(r,o)=>{const d=Q,n=X,h=ae,x=le,_=oe,f=W,w=ee,A=te,g=Z,H=Y;return m(),C("div",null,[a(H,{ref_key:"formRef",ref:D,model:i(t),"label-width":"140px","label-position":"top"},{default:l(()=>[ne,a(n,{label:"活动名称",prop:"activityName",rules:p.empty},{default:l(()=>[a(d,{modelValue:i(t).activityName,"onUpdate:modelValue":o[0]||(o[0]=e=>i(t).activityName=e),maxlength:20},null,8,["modelValue"])]),_:1},8,["rules"]),c("div",se,[a(n,{label:"开始时间",prop:"activityStartTime",rules:p.empty},{default:l(()=>[a(h,{modelValue:i(t).activityStartTime,"onUpdate:modelValue":o[1]||(o[1]=e=>i(t).activityStartTime=e),type:"datetime",placeholder:"选择开始日期",class:"!w-full"},null,8,["modelValue"])]),_:1},8,["rules"]),a(n,{label:"结束时间",prop:"activityEndTime",rules:p.activityEndTime},{default:l(()=>[a(h,{modelValue:i(t).activityEndTime,"onUpdate:modelValue":o[2]||(o[2]=e=>i(t).activityEndTime=e),type:"datetime",placeholder:"无截止日期则不选择",class:"!w-full"},null,8,["modelValue"])]),_:1},8,["rules"])]),re,a(n,{label:"选择网络",rules:p.empty,prop:"chainType"},{default:l(()=>[a(_,{modelValue:i(t).chainType,"onUpdate:modelValue":o[3]||(o[3]=e=>i(t).chainType=e),class:"w-full",onChange:R},{default:l(()=>[(m(!0),C(N,null,S(i(L).chainList,e=>(m(),T(x,{key:e.chainType,label:e.chainName,value:e.chainType},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),a(n,{"label-width":"0"},{default:l(()=>[c("div",ce,[de,i(t).chainType?(m(),T(f,{key:0,type:"primary",onClick:$},{default:l(()=>[s("添加")]),_:1})):J("",!0)]),a(A,{data:i(t).coinParamList,class:"w-full",stripe:""},{default:l(()=>[a(w,{label:"币种名称","min-width":"100",align:"center","show-overflow-tooltip":""},{default:l(e=>[a(_,{modelValue:e.row.coinCode,"onUpdate:modelValue":u=>e.row.coinCode=u,placeholder:"Select",class:"w-full",onChange:u=>I(e.row)},{default:l(()=>[(m(!0),C(N,null,S(O(e.$index),(u,M)=>(m(),T(x,{key:M,label:u.coinName,value:u.coinCode,class:"!px-2 flex-center-x gap-2"},{default:l(()=>[c("span",pe,V(u.coinName),1),c("span",ue,V(u.chainType),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(w,{label:"所属链",prop:"chainType","min-width":"100",align:"center","show-overflow-tooltip":""}),a(w,{label:"操作","min-width":"60",align:"center","show-overflow-tooltip":""},{default:l(e=>[a(f,{type:"danger",size:"small",plain:"",onClick:u=>B(e.$index)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),me,a(n,{label:"活动参与币种",prop:"activityCoin",rules:p.empty},{default:l(()=>[a(_,{modelValue:i(t).activityCoin,"onUpdate:modelValue":o[4]||(o[4]=e=>i(t).activityCoin=e),placeholder:"选择活动参与币种",class:"w-full"},{default:l(()=>[(m(!0),C(N,null,S(i(j),(e,u)=>(m(),T(x,{key:u,label:e.coinName,value:e.coinCode,class:"!px-2 flex-center-x gap-2"},{default:l(()=>[c("span",fe,V(e.coinName),1),c("span",_e,V(e.chainType),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),a(n,{label:"强制平仓"},{default:l(()=>[c("div",ve,[s(" 如果策略初始本金 "),a(n,{prop:"closeConfig.principal",rules:p.gte},{default:l(()=>[a(g,{modelValue:i(t).closeConfig.principal,"onUpdate:modelValue":o[5]||(o[5]=e=>i(t).closeConfig.principal=e),min:0,precision:2,class:"!w-[120px] !h-6 !text-xs text-center"},{prefix:l(()=>[s("≥")]),suffix:l(()=>[s("USDT")]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(" ，则当(策略实时价值/策略初始本金) "),a(n,{prop:"closeConfig.lossRatio",rules:p.gte},{default:l(()=>[a(g,{modelValue:i(t).closeConfig.lossRatio,"onUpdate:modelValue":o[6]||(o[6]=e=>i(t).closeConfig.lossRatio=e),min:0,precision:2,class:"!w-[100px] !h-6 !text-xs text-center"},{prefix:l(()=>[s("≤")]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(" ，触发该策略强制平仓； ")]),c("div",ye,[s(" 如果策略初始本金 "),a(n,{prop:"closeConfig.principal",rules:p.gte},{default:l(()=>[a(g,{modelValue:i(t).closeConfig.principal,"onUpdate:modelValue":o[7]||(o[7]=e=>i(t).closeConfig.principal=e),min:0,precision:2,class:"!w-[100px] !h-6 !text-xs text-center"},{prefix:l(()=>[s("<")]),suffix:l(()=>[s("USDT")]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(" ，则当(策略初始本金-策略实时价值) "),a(n,{prop:"closeConfig.lossNumber",rules:p.gte},{default:l(()=>[a(g,{modelValue:i(t).closeConfig.lossNumber,"onUpdate:modelValue":o[8]||(o[8]=e=>i(t).closeConfig.lossNumber=e),min:0,precision:2,class:"!w-[120px] !h-6 !text-xs text-center"},{prefix:l(()=>[s("≥")]),suffix:l(()=>[s("USDT")]),_:1},8,["modelValue"])]),_:1},8,["rules"]),s(" ，触发该策略强制平仓； ")])]),_:1}),a(n,{label:"1个体验金可兑换",prop:"rate",rules:p.gteint},{default:l(()=>[a(d,{modelValue:i(t).rate,"onUpdate:modelValue":o[9]||(o[9]=e=>i(t).rate=e)},{append:l(()=>[s("USDT")]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"]),c("div",xe,[a(f,{type:"info",disabled:i(y),onClick:o[10]||(o[10]=e=>k("close"))},{default:l(()=>[s("关闭")]),_:1},8,["disabled"]),a(f,{type:"primary",loading:i(y),onClick:z},{default:l(()=>[s("保存")]),_:1},8,["loading"])])])}}});export{Fe as _};
