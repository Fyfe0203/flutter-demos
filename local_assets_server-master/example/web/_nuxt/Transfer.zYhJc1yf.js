import{_ as ke}from"./Search.vue.t5UEXxX8.js";import Ce from"./Empty.YJn_-HYo.js";import{_ as Ae}from"./Address.vue.ct6co7hL.js";import{_ as we}from"./InputDecimal.vue.tmlsZSYi.js";import{_ as Fe}from"./SelectLike.vue.rJtvCcKc.js";import{a as Te,E as Ie}from"./el-form.bSdGaXOr.js";import{_ as $e}from"./Balance.vue.nGELT4DT.js";import Be from"./Button.bEOq16Ty.js";import{u as te,n as Ne,a as w,t as se}from"./entry.nbMAVAIE.js";import{v as Ue}from"./el-loading.D22Kx2rY.js";import{d as Ve,r as Le,c as y,a as f,j as De,an as Se,R as h,u as e,F as r,G as m,W as l,ap as ze,H as o,a2 as c,T as je,al as Re,P as Ee,Y as x,a6 as U,Z as Me}from"./swiper-vue.o0IHd9hR.js";import{u as I}from"./useFormat.c8XsG793.js";import{u as He}from"./useDialogDemo.rVmU9QRz.js";import{g as Ke}from"./ether.STda0jBd.js";import{g as Oe}from"./form-rules.35IDw2pm.js";import{r as Ze}from"./useLoopQuery.o-PQc6Nl.js";import{u as qe}from"./useSignMessage.sgOAricP.js";import"./el-input.LbCLpOjr.js";import"./typescript.WBLZcIum.js";import"./Popover.Yc1BA_KB.js";import"./castArray.IfhTYq5g.js";import"./_baseClone.DMOROgmz.js";import"./_initCloneObject.aIezyqVt.js";import"./Num.vue.DVqKCmb3.js";import"./el-button.fhXFyBz0.js";import"./validator.82JMvZTK.js";import"./useMutation.aoGi9GE9.js";import"./getConnectorClient.p5LqdYNQ.js";const Je={class:"p-5 sm:p-[30px]"},Pe={key:0,class:"cus-form"},We={key:0},Ge={key:1,class:"min-h-[300px]"},Qe={class:"text-lg text-main2 font-semibold py-5 border-b border-[#EBF1FD]"},Ye=["onClick"],Xe=["data-key"],et={class:"text-xs text-gray2 pt-1"},tt={key:1},st={class:"py-5 sm:py-10 flex-center flex-col"},ot=["data-key"],at={class:"text-xs text-gray2 pt-1"},nt={class:"border-t border-b border-[#EBF1FD] flex-center py-5"},ct={class:"w-20"},dt={class:"border border-[#EBF1FD] h-12 w-12 rounded-full text-sm sm:text-base font-semibold flex-center hover:border-primary hover:text-primary"},lt={class:"w-20"},it={class:"flex-center-x gap-3 p-2"},rt=["data-key"],mt={class:"text-base text-main2 font-medium"},ut=["data-key"],pt={class:"text-gray2 text-base flex-center gap-2 sm:py-8"},_t={key:2},ft={class:"border border-[#EBF1FD] rounded-2xl px-4 py-8 flex-center gap-3"},ht={class:"flex-center flex-col"},xt=["data-key"],vt={class:"text-xs text-gray2 pt-1"},yt={class:"flex-1 flex-center flex-center flex-col"},gt={class:"text-primary font-semibold text-sm md:text-xl pb-8 text-center"},bt=o("div",null,[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"124",height:"6",viewBox:"0 0 124 6",fill:"none",class:"w-full"},[o("path",{d:"M124 3.00001L119 0.113259L119 5.88676L124 3.00001ZM-4.37114e-08 3.5L119.5 3.50001L119.5 2.50001L4.37114e-08 2.5L-4.37114e-08 3.5Z",fill:"#5983F0"})])],-1),kt={class:"flex-center flex-col"},Ct=["data-key"],At={class:"text-xs text-gray2 pt-1"},wt={class:"py-5 grid gap-5 text-sm md:text-lg text-gray2"},Ft={class:"flex-center-x gap-5"},Tt={class:"flex-1"},It={class:"text-main2 font-semibold"},$t={class:"flex-center-x gap-5"},Bt={class:"flex-1"},Nt={key:0,class:"text-main2 font-semibold"},Ut={key:1,class:"text-main2 font-semibold"},Vt={class:"flex-center-x gap-5"},Lt={class:"flex-1"},Dt={class:"text-primary font-semibold"},ms=Ve({__name:"Transfer",props:{chainType:{},coinCode:{}},emits:["redirect","close"],setup(oe,{emit:ae}){const V=ae,L=oe,s=Le({chainType:L.chainType||"",coinCode:L.coinCode||"",address:"",amount:void 0}),g=y(()=>te().app.user??{}),D="transfer_recient_list_"+g.value.userId,b=f(JSON.parse(localStorage.getItem(D)||"[]")),S=y(()=>b.value.slice(0,5)),u=y(()=>b.value.find(t=>t.accountAddress===s.address)),$=f(!1),p=f({}),k=f(1),ne=t=>{s.address=t.accountAddress,B()},B=()=>{$.value=!0,w.get("/account/spot/send/info",s,{lazy:!0,watch:!1}).then(({data:t})=>{p.value=t.value.data??{},k.value=2,V("redirect",{title:se("account.t40")})}).finally(()=>{$.value=!1})},ce=()=>{if(s.address.length===42){const t={accountAddress:s.address,nickName:"",headUrl:""};S.value.findIndex(d=>d.accountAddress===s.address)!==-1||b.value.splice(0,0,t),le(s.address,t),B()}},de=y(()=>te().app.coins.filter(t=>t.chainType===s.chainType)),le=(t,n)=>{w.get("/account/spot/send/cus",{accountAddress:t}).then(({data:d})=>{var i;const _=((i=d.value)==null?void 0:i.data)??{};n.nickName=_.nickName,n.headUrl=_.headUrl,localStorage.setItem(D,JSON.stringify(b.value))})},ie=Oe(y(()=>{var t;return{balance:(t=p.value)==null?void 0:t.tokenBalance,coinCode:s.coinCode,minBalance:1}})),z=f(),re=t=>{t==null||t.validate(n=>{n&&(k.value=3)})},me=y(()=>{const{payType:t=1,feeType:n=1,feeAmount:d=0}=p.value,_=n===1?d:I.mul(s.amount,d).toFixed(6);let i="0",A="0";return t===1?(i=I.plus(s.amount,_).toFixed(6),A=s.amount??"0"):t===2&&(i=s.amount??"0",A=I.minus(s.amount,_).toFixed(6)),{cost:i,receipt:A}}),{isConnected:ue}=Ne(),{signMessageAsync:pe}=qe(),C=f(!1),F=f(""),_e=()=>{C.value=!0,w.post("/account/spot/send",{receiveAmount:s.amount,chainType:s.chainType,coinCode:s.coinCode,receiveAddress:s.address,sendFeeParam:p.value}).then(async({data:t})=>{const n=t.value.data;if(!(n!=null&&n.bizId)){C.value=!1;return}if(F.value=n.bizId,n!=null&&n.signFlag){ue.value||await He.loginWithoutSign();const d=await pe({message:{raw:Ke(n.userOpHash)}});await w.post("/account/spot/send/sign",{chainType:s.chainType,bizId:F.value,signature:d})}N()}).catch(()=>{C.value=!1,Ze(F.value)})};let T;const N=async()=>{var t;try{const{data:n}=await w.post("/account/spot/send/callback",{bizId:F.value}),d=(t=n.value)==null?void 0:t.data;d?fe(d):T=setTimeout(N,1e3)}catch{T=setTimeout(N,1e3)}},fe=t=>{C.value=!1,V("redirect",{title:se("bot.t07"),component:"AccountTransferResult",props:t})};return De(()=>{T&&clearTimeout(T)}),(t,n)=>{var R,E,M,H,K,O,Z,q,J,P,W,G,Q,Y,X,ee;const d=ke,_=Ce,i=Ae,A=we,he=Fe,xe=Te,ve=Ie,ye=$e,j=Be,v=Se("lazy"),ge=Ue;return h((r(),m("div",Je,[e(k)===1?(r(),m("div",Pe,[l(d,{modelValue:e(s).address,"onUpdate:modelValue":n[0]||(n[0]=a=>e(s).address=a),placeholder:t.$t("bot.t55"),onKeyup:ze(ce,["enter"])},null,8,["modelValue","placeholder"]),e(b).length?(r(),m("div",Ge,[o("div",Qe,c(t.$t("bot.t54")),1),(r(!0),m(je,null,Re(e(S),(a,be)=>(r(),m("div",{key:be,class:Ee(["border-b border-[#EBF1FD] py-4 px-2 flex-center-x gap-2 cursor-pointer hover:bg-[rgba(235,241,253,0.5)]",a.accountAddress===e(s).address?"bg-[rgba(235,241,253,0.5)]":""]),onClick:St=>ne(a)},[h(o("img",{"data-key":a==null?void 0:a.accountAddress,class:"w-10 h-10 rounded-full object-cover",alt:""},null,8,Xe),[[v,a==null?void 0:a.headUrl]]),o("div",null,[l(i,{address:a==null?void 0:a.accountAddress,class:"text-base font-semibold text-main2"},null,8,["address"]),o("div",et,c((a==null?void 0:a.nickName)||"unknow"),1)])],10,Ye))),128))])):(r(),m("div",We,[l(_,{class:"py-20"})]))])):e(k)===2?(r(),m("div",tt,[o("div",st,[h(o("img",{"data-key":(R=e(u))==null?void 0:R.accountAddress,class:"w-[54px] h-[54px] rounded-full object-cover",alt:""},null,8,ot),[[v,(E=e(u))==null?void 0:E.headUrl]]),l(i,{address:(M=e(u))==null?void 0:M.accountAddress,class:"text-base font-semibold text-main2 pt-[10px]"},null,8,["address"]),o("div",at,c((H=e(u))==null?void 0:H.nickName),1)]),l(ve,{ref_key:"formRef",ref:z,"label-position":"top",model:e(s),class:"cus-form",style:{"--placeholder":"var(--text-gray-sec)"},"hide-required-asterisk":""},{default:x(()=>[l(xe,{prop:"amount",label:"Amount",rules:e(ie).amount},{default:x(()=>[o("div",nt,[o("div",ct,[o("button",dt,c(t.$t("common.t13")),1)]),l(A,{modelValue:e(s).amount,"onUpdate:modelValue":n[1]||(n[1]=a=>e(s).amount=a),class:"text-center no-border !text-xl sm:!text-[30px] md:!text-[50px] font-semibold flex-1",placeholder:"0.00",style:{"--el-input-height":"50px","--el-input-text-color":"var(--el-color-primary)"}},null,8,["modelValue"]),o("div",lt,[l(he,{modelValue:e(s).coinCode,"onUpdate:modelValue":n[2]||(n[2]=a=>e(s).coinCode=a),list:e(de),"label-key":"coinName","value-key":"coinCode",class:"no-border text-center",style:{"--el-input-padding":"0","--el-input-height":"50px"},width:140,onChange:B},{option:x(({item:a})=>[o("div",it,[h(o("img",{"data-key":a.coinCode,class:"h-7 w-7 rounded-full object-cover",alt:""},null,8,rt),[[v,a.imgUrl]]),o("div",mt,c(a.coinCode),1)])]),default:x(({item:a})=>[h((r(),m("img",{key:a.coinCode,"data-key":a.coinCode,class:"h-12 w-12 rounded-full object-cover",alt:""},null,8,ut)),[[v,a.imgUrl]])]),_:1},8,["modelValue","list"])])])]),_:1},8,["rules"])]),_:1},8,["model"]),o("div",pt,[l(ye,{balance:{balance:+((K=e(p))==null?void 0:K.tokenBalance),coinCode:e(s).coinCode},"chain-type":e(s).chainType,"coin-code":e(s).coinCode,"num-class":"font-semibold"},{default:x(()=>[U(c(t.$t("bot.t56"))+"ï¼š ",1)]),_:1},8,["balance","chain-type","coin-code"])]),l(j,{class:"mt-5",onClick:n[3]||(n[3]=a=>re(e(z)))},{default:x(()=>[U(c(t.$t("login.t33")),1)]),_:1})])):e(k)===3?(r(),m("div",_t,[o("div",ft,[o("div",ht,[h(o("img",{"data-key":(O=e(g))==null?void 0:O.accountAddress,class:"w-[54px] h-[54px] rounded-full object-cover",alt:""},null,8,xt),[[v,(Z=e(g))==null?void 0:Z.headUrl]]),l(i,{address:(q=e(g))==null?void 0:q.accountAddress,class:"text-sm md:text-base font-semibold text-main2 pt-[10px]"},null,8,["address"]),o("div",vt,c((J=e(g))==null?void 0:J.nickname),1)]),o("div",yt,[o("div",gt,c(e(s).amount)+" "+c(e(s).coinCode),1),bt]),o("div",kt,[h(o("img",{"data-key":(P=e(u))==null?void 0:P.accountAddress,class:"w-[54px] h-[54px] rounded-full object-cover",alt:""},null,8,Ct),[[v,(W=e(u))==null?void 0:W.headUrl]]),l(i,{address:(G=e(u))==null?void 0:G.accountAddress,class:"text-sm md:text-base font-semibold text-main2 pt-[10px]"},null,8,["address"]),o("div",At,c((Q=e(u))==null?void 0:Q.nickName),1)])]),o("div",wt,[o("div",Ft,[o("div",Tt,c(t.$t("bot.t57")),1),o("div",It,c(e(s).amount)+" "+c(e(s).coinCode),1)]),o("div",$t,[o("div",Bt,c(t.$t("account.t12")),1),((Y=e(p))==null?void 0:Y.feeType)===1?(r(),m("div",Nt,c((X=e(p))==null?void 0:X.feeAmount)+" "+c(e(s).coinCode),1)):(r(),m("div",Ut,c(("useFormat"in t?t.useFormat:e(I)).mul(((ee=e(p))==null?void 0:ee.feeAmount)??0,e(s).amount).toFixed(2))+" "+c(e(s).coinCode),1))]),o("div",Vt,[o("div",Lt,c(t.$t("bot.t58")),1),o("div",Dt,c(e(me).receipt)+" "+c(e(s).coinCode),1)])]),l(j,{class:"mt-5",loading:e(C),onClick:_e},{default:x(()=>[U(c(t.$t("login.t33")),1)]),_:1},8,["loading"])])):Me("",!0)])),[[ge,e($)]])}}});export{ms as default};
